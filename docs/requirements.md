# 📘 AI 生成画像ギャラリーアプリ

## 要件定義書（Version 1.1）

---

# 1. アプリ概要

本アプリは、画像生成 AI で作成した画像を保存し、ギャラリー形式で閲覧・検索できる画像管理アプリである。画像、作風、セリフなどを登録し、後から検索・整理できることを目的とする。

---

# 2. 想定ユーザー

- AI 画像生成を日常的に行う個人クリエイター
- 画像を整理し、後から見返したいユーザー
- 作品管理用に簡易データベースが欲しいユーザー

---

# 3. 使用技術（想定）

- Backend：Supabase（PostgreSQL + Storage）
- Frontend：Next.js (App Router), Tailwind CSS
- Storage：Supabase Storage（画像の保存）
- 認証：今回は最小構成のため **なし**

---

# 4. 機能要件

## 4.1 必須機能（MVP）

### ① 画像登録機能

- 画像ファイルをアップロード
  - **バリデーション**:
    - サイズ: 最大 10MB
    - 形式: JPEG, PNG, WebP
    - 解像度: 最大 4096px (推奨)
- 作風（style）をテキストで入力 (最大 100 文字)
- セリフ（caption）をテキストで入力 (最大 500 文字)
- Supabase Storage に画像保存し、そのパスを DB に登録
- UX: アップロード中のインジケータ表示、完了時のトースト通知

### ② 画像一覧（ギャラリー表示）

- 保存された画像を一覧で表示
- Masonry / グリッド形式
  - モバイル: 2 列
  - タブレット/デスクトップ: 3 列〜
- ソート：新しい順（created_at desc）
- パフォーマンス: Next.js Image コンポーネントを使用 (placeholder="blur",
  loading="lazy")

### ③ 検索機能

- **作風**による検索（部分一致）
- **セリフ**による検索（部分一致）
- インクリメンタルサーチまたは Enter での検索実行

### ④ 画像詳細画面

- 画像の大きな表示
- メタデータ表示: 作風, セリフ, 登録日時
- **削除ボタン**: 確認モーダルを表示
- **ダウンロードボタン**: 原本画像をダウンロード

### ⑤ データ削除

- 画像＋ DB レコードを削除
- 整合性: DB 削除と Storage 削除を確実に行う (Edge Functions または Client 側での順次実行)

---

# 5. 非機能要件

## 5.1 パフォーマンス

- 一覧画面はページング（Infinite Scroll または Load More ボタン）
- 画像表示の最適化 (Next.js Image Optimization)

## 5.2 セキュリティ

- **認証なし**: 誰でも閲覧・アップロード・削除が可能 (MVP 仕様)
- **XSS 対策**: caption/style 表示時のエスケープ
- **Storage**: Public Bucket を使用

## 5.3 可用性・拡張性

- ストレージと DB を分離することで拡張性確保

---

# 6. データベース設計（最小構成）

## 6.1 テーブル：`images`

| カラム名   | 型        | 説明                    |
| ---------- | --------- | ----------------------- |
| id         | uuid (PK) | 一意 ID                 |
| style      | text      | 作風 (Index: pg_trgm)   |
| caption    | text      | セリフ (Index: pg_trgm) |
| image_url  | text      | 画像パス (bucket/path)  |
| created_at | timestamp | 登録日時（自動設定）    |

---

# 7. 画面仕様

## 7.1 一覧画面（ギャラリー）

- ヘッダー: タイトル, 検索バー, アップロードボタン
- グリッド: レスポンシブ対応 Masonry Layout

## 7.2 画像登録画面

- ドラッグ＆ドロップ対応のアップロードエリア
- プレビュー表示
- 入力フォーム (Style, Caption)
- 保存ボタン (Loading 状態あり)

## 7.3 詳細画面

- 大画像表示
- サイドバーまたは下部にメタデータ
- 操作アクション (削除, ダウンロード)

---

# 8. 今後の拡張候補（v2 以降）

- マルチユーザー化（ログイン機能）

---

# 9. MVP の完成到達基準（Done の定義）

- 画像を登録できる（バリデーション含む）
- ギャラリーで一覧表示できる（レスポンシブ・高速表示）
- 作風・セリフ検索が動作する
- 詳細画面が表示できる
- データが Supabase DB & Storage に保存されている
- 削除が可能（DB と Storage の整合性が取れる）
- ダウンロードが可能
